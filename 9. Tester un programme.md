## Débogage
Le débogage est important pour le bon fonctionnement d'un programme aussi bien au niveau du code que de la gestion de la mémoire par exemple. La méthode "brute" couramment utilisée consiste à mettre beaucoup de fonctions Serial.print() et à visualiser tous les messages. Cette méthode a ses limites, notamment une lourdeur du code ainsi qu'un manque de finesse dans l'analyse du code. Pour y remédier, il existe des solutions pour déboguer l'ESP32.

**Débogage sur Arduino**

Contrairement à la plupart des IDE, l’IDE Arduino n’a pas de débogueur officiel. Vous lancez votre programme puis vous êtes incapable de savoir ce qui se passe dans l’appareil cible et comment votre code se comporte. En effet, le code Arduino est habituellement utilisé pour contrôler des entrées/sorties physiques du monde « réel ». En pratique, il faut donc trouver des alternatives pour déboguer le code, par exemple via un simulateur.
L’outil proposé par le fabricant Espressif, ESP-IDF, fournit un excellent débogueur avec différents niveaux associés à différentes couleurs. Pour obtenir des fonctionnalités presque similaires, nous pouvons installer la librairie *SerialDebug* pour l’IDE Arduino. Les informations concernant cette librairie et son fonctionnement sont disponibles à partir du lien suivant : https://randomnerdtutorials.com/serialdebug-library-arduino-ide/ (voir la partie Installing SerialDebug Library dans cette page). Cependant, le nombre de contributeurs est faible, de 1 à 2 et le projet SerialDebug est toujours en version Beta et n'évolue pas.

**Outil Visual Micro pour Arduino dans Visual Studio**

Il s’agit d’un outil complet avec débogueur logiciel dans l’environnement Visual Studio. Cependant, la gratuité n’est assurée que pendant 3 mois, ce qui peut être suffisant pour développer un projet Arduino de type .ino.
Dans le menu, Outils -> Extensions et mises à jour, installez Arduino IDE for Visual Studio.

![image](https://user-images.githubusercontent.com/44494044/130683083-25d5a60d-a242-4604-a824-1ef812fea934.png)

Une ligne horizontale supplémentaire apparaît pour Arduino avec le téléversement à droite :
 
![image](https://user-images.githubusercontent.com/44494044/130683108-997a2904-bad2-4546-872e-18c982e67d91.png)

Dans le menu, vous trouverez l’onglet vMicro avec les sous-menus suivants qui offrent tous les outils de développement nécessaires :

![image](https://user-images.githubusercontent.com/44494044/130683204-693baaac-c6b9-4390-a375-d7be81818d48.png)

Pour plus d’informations, allez sur le site :
https://www.visualmicro.com/.

Pour télécharger l’outil Visual Micro :
https://www.visualmicro.com/page/Arduino-Visual-Studio-Downloads.aspx.

 
Avec vMicro, possibilité d’insérer un point d’arrêt dans un croquis (Sketch) Arduino et de mettre une fenêtre graphique (ou même plusieurs) pour visualiser la valeur considérée.
Clic-droit sur une ligne de code : Point d’arrêt -> Insérer un point d’arrêt.
Mettre le curseur sur le point d’arrêt et cliquez sur l’icone paramètres qui apparaît.
Exemple de la valeur touchValue (d'un programme Touch) qui est dans une boucle et dont la valeur change, pour faire apparaître l’affichage, mettez : {@plot.nomFenetre touchValue}

![image](https://user-images.githubusercontent.com/44494044/130683491-bac84d68-a2a8-4a28-a694-979459ccb477.png)

Exemple d'affichage :

![image](https://user-images.githubusercontent.com/44494044/130683661-966fdc57-0941-45b9-9e1e-1958cc08c3f3.png)

## Débogage sous VS Code 

Le débogage se fait à l'aide d'un matériel externe. Il nécessite l'installation d'un driver et quelques lignes supplémentaires de configuration dans le fichier platformio.ini de votre projet. La procédure à suivre est bien décrite dans le tutoriel suivant : https://www.instructables.com/How-to-Use-a-Debugger-on-an-ESP32/.
ESP-Prog est la meilleure alternative pour le débogage et elle est bien documentée : https://docs.platformio.org/en/latest/plus/debug-tools/esp-prog.html.
Vérifiez la bonne installation de votre driver à l'aide de votre fgestionnaire de périphériques :

![image](https://user-images.githubusercontent.com/44494044/130686429-fca24acd-d524-4f68-80cd-307e4f3f1744.png)

![image](https://user-images.githubusercontent.com/44494044/130686190-36a5187a-5ed3-4f35-aa58-98db7c60563a.png)

L'intérêt du débogage et d'ESP-Prog sont mis en évidence dans cette vidéo : https://www.youtube.com/watch?v=psMqilqlrRQ&t=892s. 

Voir la documentation officielle concernant JTAG : https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/jtag-debugging/index.html.

## Tests unitaires

D'après Wikipédia, en programmation informatique, le test unitaire (ou « T.U. », ou « U.T. » en anglais) est une procédure permettant de vérifier le bon fonctionnement d'une partie précise d'un logiciel ou d'une portion d'un programme (appelée « unité » ou « module »). Il fait partie de la panoplie des bonnes pratiques de programmation. Pour l'ESP32, il suffit d'ajouter la bibliothèque <unity.h> et d'ajouter nos tests unitaires, par exemple : *TEST_ASSERT_EQUAL(13, LED_BUILTIN);* pour vérifier l'égalité entre 13 et LED_BUILTIN, or LED_BUILTIN vaut 2 (GPIO2) pour le NodeMCU ESP32.

Comprendre et refaire l'exemple suivant : https://docs.platformio.org/en/latest/tutorials/core/unit_testing_blink.html#tutorial-unit-testing-blink.

![image](https://user-images.githubusercontent.com/44494044/130689223-3d6a1efa-ce83-43ee-bbe1-f2162304f3dd.png)

Il y a donc ce test qui échoue car 13 était attendu à la place de 2. Ceci n'est pas vrai dans notre cas, donc bien mettre 2 dans ce test et non la valeur 13 du programme d'exemple.
